<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>Docházka – Přehled</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js"></script>
  <style>
    #calendar {
      max-width: 900px;
      margin: 40px auto;
    }
  </style>
</head>
<body>
  <h2>Docházka – Kalendář</h2>
  <div id="calendar"></div>

<!-- ... zbytek hlavičky zůstává stejný -->

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD4j1bO7JDbzUM-ca4AWUSkGYpmglWK_IQ",
    authDomain: "dochazka-app.firebaseapp.com",
    projectId: "dochazka-app",
    storageBucket: "dochazka-app.firebasestorage.app",
    messagingSenderId: "912220280247",
    appId: "1:912220280247:web:e0b27491b9234cba984432",
    measurementId: "G-G8PPKTK907"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  document.addEventListener("DOMContentLoaded", function () {
    const calendarEl = document.getElementById("calendar");
    let selectedDates = [];

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      selectable: true,
      select: function(info) {
        selectedDates = [];
        let current = new Date(info.start);
        while (current <= info.end) {
          selectedDates.push(current.toISOString().split('T')[0]);
          current.setDate(current.getDate() + 1);
        }

        // Odebrat poslední datum, protože FullCalendar bere range včetně konce
        selectedDates.pop();

        showTypeSelection();
      }
    });

    calendar.render();

    function showTypeSelection() {
      const modal = document.createElement("div");
      modal.innerHTML = `
        <div style="position:fixed; top:0; left:0; width:100%; height:100%; background:#00000099; display:flex; align-items:center; justify-content:center; z-index:1000;">
          <div style="background:white; padding:20px; border-radius:10px; text-align:center;">
            <h3>Vyber typ volna</h3>
            <button id="btn-dovolena">Dovolená</button>
            <button id="btn-neplacene">Neplacené volno</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      document.getElementById("btn-dovolena").onclick = () => submitRequest("dovolená", modal);
      document.getElementById("btn-neplacene").onclick = () => submitRequest("neplacené", modal);
    }

    async function submitRequest(type, modal) {
      const user = auth.currentUser;
      if (user) {
        for (let date of selectedDates) {
          await addDoc(collection(db, "zadosti"), {
            datum: date,
            typ: type,
            email: user.email,
            stav: "čeká na schválení"
          });
        }
        alert("Žádost(y) odeslány.");
      } else {
        alert("Uživatel není přihlášen.");
      }

      document.body.removeChild(modal);
    }
  });
</script>
  
</body>
</html>
